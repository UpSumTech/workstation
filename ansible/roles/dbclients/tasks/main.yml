---
# These tasks set up db common clients

- name: Add the gpg key for mycli
  shell: curl https://packagecloud.io/gpg.key | apt-key add -
  become: true
  become_user: root

- name: Add the source for mycli
  shell: echo "deb https://packagecloud.io/amjith/mycli/ubuntu/ trusty main" | tee -a /etc/apt/sources.list
  become: true
  become_user: root

- apt: update_cache=yes
  become: true
  become_user: root

- name: Install mycli
  apt: name=mycli
  become: true
  become_user: root

- name: Install apt packages to install pgcli
  apt: "name='{{ item }}' state=present update_cache=yes install_recommends=no"
  with_items:
    - libpq-dev
  become: true
  become_user: root

- name: Install python packages for ssl
  pip: name={{ item }}
  with_items:
    - pyopenssl
    - ndg-httpsclient
    - pyasn1
    - requests[security]
  become: true
  become_user: root

- name: Install pgcli
  pip: name=pgcli
  become: true
  become_user: root

- name: Install concurrent multi server mysql client
  shell: >
    cd /usr/local/bin &&
    curl -s -S -L -0 https://github.com/github/ccql/releases/download/v1.1.4/ccql-binary-linux-20160316084430.tar.gz | tar xz
  become: true
  become_user: root
