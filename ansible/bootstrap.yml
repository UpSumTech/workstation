---
# This playbook bootstraps a local machine

- hosts: all
  sudo: yes

  tasks:
    - name: Add a user group
      group: name={{ user }}
              system=yes
              state=present

    - name: Adds a user to the previous and sudo groups
      user: name={{ user }}
            system=yes
            createhome=true
            shell=/bin/bash
            generate_ssh_key=yes
            group={{ user }}
            groups=sudo
            append=yes

    - name: Add an entry to the sudoers.d directory
      shell: echo "{{ user }} ALL=(ALL) NOPASSWD:ALL" > "/etc/sudoers.d/{{ user }}"

    - authorized_key: user={{ user }} key="{{ lookup('file', '~/.ssh/id_rsa.pub') }}" exclusive=yes
